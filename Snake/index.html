<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è´ªåƒè›‡æ¸¸æˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Comic Sans MS', 'å¹¼åœ†', sans-serif;
        }
        
        body {
            background-color: #f0f9ff;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
            background-image: radial-gradient(#c5e1ff 10%, transparent 11%);
            background-size: 30px 30px;
            background-position: 0 0, 15px 15px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        h1 {
            color: #ff6b6b;
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 3px 3px 0 #ffd166;
            letter-spacing: 2px;
        }
        
        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: white;
            border-radius: 25px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 150, 0.15);
            border: 8px solid #ffd166;
            max-width: 800px;
            width: 100%;
        }
        
        .stats {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-bottom: 20px;
            background-color: #118ab2;
            padding: 15px;
            border-radius: 15px;
            color: white;
            font-size: 1.4rem;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-weight: bold;
            font-size: 2rem;
            color: #ffd166;
        }
        
        .game-area {
            position: relative;
            width: 100%;
            margin-bottom: 20px;
        }
        
        #gameCanvas {
            background-color: #c7f2ff;
            border-radius: 15px;
            display: block;
            margin: 0 auto;
            border: 5px solid #06d6a0;
            box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.1);
        }
        
        .controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            margin-top: 20px;
        }
        
        .action-buttons {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            width: 100%;
            justify-content: center;
        }
        
        .action-btn {
            padding: 15px 30px;
            font-size: 1.5rem;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
            box-shadow: 0 5px 0 rgba(0, 0, 0, 0.2);
        }
        
        .action-btn:active {
            transform: translateY(5px);
            box-shadow: 0 0 0 rgba(0, 0, 0, 0.2);
        }
        
        #startBtn {
            background-color: #06d6a0;
            color: white;
        }
        
        #pauseBtn {
            background-color: #118ab2;
            color: white;
        }
        
        #restartBtn {
            background-color: #ff6b6b;
            color: white;
        }
        
        .speed-controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
            width: 100%;
        }
        
        .speed-label {
            font-size: 1.3rem;
            color: #118ab2;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .speed-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .speed-btn {
            padding: 12px 25px;
            font-size: 1.2rem;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
            background-color: #e0e0e0;
            color: #333;
        }
        
        .speed-btn.active {
            background-color: #ffd166;
            color: #333;
            box-shadow: 0 4px 0 #ffb142;
        }
        
        .speed-btn:not(.active):hover {
            background-color: #d0d0d0;
        }
        
        .instructions {
            background-color: #e8f4ff;
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
            width: 100%;
            border: 4px dashed #118ab2;
        }
        
        .instructions h2 {
            color: #118ab2;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .instructions ul {
            list-style-type: none;
            padding-left: 10px;
        }
        
        .instructions li {
            margin-bottom: 8px;
            font-size: 1.2rem;
            color: #333;
            display: flex;
            align-items: center;
        }
        
        .instructions li:before {
            content: "ğŸ";
            margin-right: 10px;
        }
        
        .game-over {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 107, 107, 0.9);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 15px;
            z-index: 10;
        }
        
        .game-over h2 {
            color: white;
            font-size: 3.5rem;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .game-over p {
            color: white;
            font-size: 2rem;
            margin-bottom: 30px;
        }
        
        .snake-part {
            display: inline-block;
            width: 20px;
            height: 20px;
            background-color: #06d6a0;
            margin-right: 5px;
            border-radius: 50%;
        }
        
        .food-emoji {
            font-size: 1.5rem;
            margin-right: 5px;
        }
        
        @media (max-width: 768px) {
            .game-container {
                padding: 15px;
            }
            
            h1 {
                font-size: 2.5rem;
            }
            
            #gameCanvas {
                width: 100%;
                height: auto;
            }
            
            .action-buttons {
                flex-wrap: wrap;
            }
            
            .action-btn {
                padding: 12px 20px;
                font-size: 1.3rem;
            }
            
            .speed-buttons {
                gap: 10px;
            }
            
            .speed-btn {
                padding: 10px 20px;
                font-size: 1.1rem;
            }
        }
        
        .food-points {
            font-weight: bold;
            color: #ff6b6b;
            margin-left: 5px;
        }
        
        .control-hint {
            margin-top: 10px;
            font-size: 1.2rem;
            color: #666;
            text-align: center;
            background-color: #ffd166;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    
    <div class="game-container">
        <div class="stats">
            <div class="stat-item">
                <div>å½“å‰åˆ†æ•°</div>
                <div id="score" class="stat-value">0</div>
            </div>
            <div class="stat-item">
                <div>è›‡é•¿åº¦</div>
                <div id="length" class="stat-value">3</div>
            </div>
            <div class="stat-item">
                <div>æœ€é«˜åˆ†</div>
                <div id="highScore" class="stat-value">0</div>
            </div>
        </div>
        
        <div class="game-area">
            <canvas id="gameCanvas" width="600" height="400"></canvas>
            
            <div class="game-over" id="gameOverScreen">
                <h2>æ¸¸æˆç»“æŸ!</h2>
                <p>ä½ çš„å¾—åˆ†: <span id="finalScore">0</span></p>
                <button id="playAgainBtn" class="action-btn" style="background-color:#ffd166;color:#333;">å†ç©ä¸€æ¬¡</button>
            </div>
        </div>
        

        
        <div class="controls">
            <div class="action-buttons">
                <button class="action-btn" id="startBtn">å¼€å§‹æ¸¸æˆ</button>
                <button class="action-btn" id="pauseBtn">æš‚åœ</button>
                <button class="action-btn" id="restartBtn">é‡æ–°å¼€å§‹</button>
            </div>

        <div class="speed-controls">
            <div class="speed-label">é€‰æ‹©æ¸¸æˆé€Ÿåº¦:</div>
            <div class="speed-buttons">
                <button class="speed-btn" id="slowSpeed">æ…¢é€Ÿ</button>
                <button class="speed-btn" id="mediumSpeed">ä¸­ç­‰</button>
                <button class="speed-btn active" id="fastSpeed">è¾ƒå¿«</button>
                <button class="speed-btn" id="veryFastSpeed">å¿«é€Ÿ</button>
            </div>
        </div>            
            

            <div class="control-hint">
                ä½¿ç”¨é”®ç›˜æ–¹å‘é”® â†‘ â†“ â† â†’ æ§åˆ¶å°è›‡ç§»åŠ¨
            </div>
        </div>
        
        <div class="instructions">
            <h2>æ¸¸æˆç©æ³•</h2>
            <ul>
                <li>æ§åˆ¶å°è›‡åƒæ‰å½©è‰²çš„é£Ÿç‰© 
                    <span class="food-emoji">ğŸ¦</span><span class="food-points">(10åˆ†)</span>
                    <span class="food-emoji">ğŸ©</span><span class="food-points">(30åˆ†)</span>
                    <span class="food-emoji">ğŸ•</span><span class="food-points">(50åˆ†)</span>
                    <span class="food-emoji">ğŸ</span><span class="food-points">(80åˆ†)</span>
                </li>
                <li>æ¯åƒä¸€ä¸ªé£Ÿç‰©ï¼Œå°è›‡å°±ä¼šé•¿é•¿ä¸€èŠ‚</li>
                <li>ä¸è¦æ’åˆ°å¢™å£æˆ–è€…è‡ªå·±çš„èº«ä½“</li>
                <li>åšæŒè¶Šä¹…ï¼Œå¾—åˆ†è¶Šé«˜ï¼</li>
            </ul>
        </div>
    </div>

    <script>
        // æ¸¸æˆå˜é‡
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreElement = document.getElementById('score');
        const lengthElement = document.getElementById('length');
        const highScoreElement = document.getElementById('highScore');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const finalScoreElement = document.getElementById('finalScore');
        
        // æ¸¸æˆå…ƒç´ 
        let snake = [];
        let food = {};
        let direction = 'right';
        let nextDirection = 'right';
        let gameSpeed = 500; // é»˜è®¤é€Ÿåº¦ï¼šæ…¢é€Ÿ
        let gameInterval;
        let score = 0;
        let highScore = localStorage.getItem('snakeHighScore') || 0;
        let gameRunning = false;
        let gamePaused = false;
        
        // é€Ÿåº¦æ¡£ä½å®šä¹‰ï¼ˆæ¯«ç§’ï¼‰
        const SPEEDS = {
            SLOW: 500,      // æ…¢é€Ÿï¼ˆé»˜è®¤ï¼‰
            MEDIUM: 350,    // ä¸­ç­‰
            FAST: 250,      // è¾ƒå¿«
            VERY_FAST: 150  // å¿«é€Ÿ
        };
        
        // å½“å‰é€Ÿåº¦æ¡£ä½
        let currentSpeed = 'SLOW';
        
        // åˆå§‹åŒ–æœ€é«˜åˆ†æ˜¾ç¤º
        highScoreElement.textContent = highScore;
        
        // é£Ÿç‰©ç±»å‹å’Œé¢œè‰²ï¼ˆè‹¹æœåˆ†å€¼æœ€é«˜ï¼Œå†°æ·‡æ·‹æœ€ä½ï¼‰
        const foodTypes = [
            { emoji: 'ğŸ', color: '#ff6b6b', points: 80, name: 'è‹¹æœ' },
            { emoji: 'ğŸ•', color: '#ffd166', points: 50, name: 'æŠ«è¨' },
            { emoji: 'ğŸ©', color: '#118ab2', points: 30, name: 'ç”œç”œåœˆ' },
            { emoji: 'ğŸ¦', color: '#06d6a0', points: 10, name: 'å†°æ·‡æ·‹' }
        ];
        
        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            // åˆå§‹åŒ–è›‡
            snake = [
                { x: 10, y: 10 },
                { x: 9, y: 10 },
                { x: 8, y: 10 }
            ];
            
            // ç”Ÿæˆç¬¬ä¸€ä¸ªé£Ÿç‰©
            generateFood();
            
            // é‡ç½®æ¸¸æˆçŠ¶æ€
            direction = 'right';
            nextDirection = 'right';
            score = 0;
            
            // åº”ç”¨å½“å‰é€Ÿåº¦
            gameSpeed = SPEEDS[currentSpeed];
            
            // æ›´æ–°æ˜¾ç¤º
            updateScore();
            
            // ç»˜åˆ¶æ¸¸æˆ
            drawGame();
        }
        
        // ç”Ÿæˆé£Ÿç‰©
        function generateFood() {
            // æ ¹æ®æ¦‚ç‡ç”Ÿæˆä¸åŒé£Ÿç‰© (æ¦‚ç‡é«˜çš„é£Ÿç‰©åˆ†å€¼ä½)
            const rand = Math.random();
            let foodType;
            
            if (rand < 0.3) {
                foodType = foodTypes[0]; // è‹¹æœ 30% æ¦‚ç‡ï¼ˆåˆ†å€¼æœ€é«˜ï¼‰
            } else if (rand < 0.6) {
                foodType = foodTypes[1]; // æŠ«è¨ 30% æ¦‚ç‡
            } else if (rand < 0.8) {
                foodType = foodTypes[2]; // ç”œç”œåœˆ 20% æ¦‚ç‡
            } else {
                foodType = foodTypes[3]; // å†°æ·‡æ·‹ 20% æ¦‚ç‡ï¼ˆåˆ†å€¼æœ€ä½ï¼‰
            }
            
            // ç¡®ä¿é£Ÿç‰©ä¸ä¼šå‡ºç°åœ¨è›‡èº«ä¸Š
            let foodOnSnake;
            do {
                foodOnSnake = false;
                food = {
                    x: Math.floor(Math.random() * (canvas.width / 20)),
                    y: Math.floor(Math.random() * (canvas.height / 20)),
                    type: foodType
                };
                
                // æ£€æŸ¥æ˜¯å¦ä¸è›‡èº«é‡å 
                for (let segment of snake) {
                    if (segment.x === food.x && segment.y === food.y) {
                        foodOnSnake = true;
                        break;
                    }
                }
            } while (foodOnSnake);
        }
        
        // ç»˜åˆ¶æ¸¸æˆ
        function drawGame() {
            // æ¸…ç©ºç”»å¸ƒ
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ç»˜åˆ¶èƒŒæ™¯ç½‘æ ¼ï¼ˆç®€å•ç½‘æ ¼ï¼Œå¸®åŠ©å­©å­å®šä½ï¼‰
            drawGrid();
            
            // ç»˜åˆ¶è›‡
            snake.forEach((segment, index) => {
                // è›‡å¤´ç”¨ä¸åŒé¢œè‰²
                if (index === 0) {
                    ctx.fillStyle = '#06d6a0';
                } else {
                    // è›‡èº«ç”¨æ¸å˜è‰²
                    const colorValue = Math.max(100, 255 - index * 5);
                    ctx.fillStyle = `rgb(6, ${214 - index * 3}, ${160 - index * 2})`;
                }
                
                // ç»˜åˆ¶åœ†è§’çŸ©å½¢ä½œä¸ºè›‡èº«
                drawRoundedRect(segment.x * 20, segment.y * 20, 18, 18, 5);
                
                // ç»˜åˆ¶è›‡çœ¼ç›ï¼ˆåªåœ¨å¤´éƒ¨ï¼‰
                if (index === 0) {
                    ctx.fillStyle = '#000';
                    
                    // æ ¹æ®æ–¹å‘è°ƒæ•´çœ¼ç›ä½ç½®
                    let eye1X, eye1Y, eye2X, eye2Y;
                    if (direction === 'right') {
                        eye1X = segment.x * 20 + 13;
                        eye1Y = segment.y * 20 + 5;
                        eye2X = segment.x * 20 + 13;
                        eye2Y = segment.y * 20 + 13;
                    } else if (direction === 'left') {
                        eye1X = segment.x * 20 + 5;
                        eye1Y = segment.y * 20 + 5;
                        eye2X = segment.x * 20 + 5;
                        eye2Y = segment.y * 20 + 13;
                    } else if (direction === 'up') {
                        eye1X = segment.x * 20 + 5;
                        eye1Y = segment.y * 20 + 5;
                        eye2X = segment.x * 20 + 13;
                        eye2Y = segment.y * 20 + 5;
                    } else { // down
                        eye1X = segment.x * 20 + 5;
                        eye1Y = segment.y * 20 + 13;
                        eye2X = segment.x * 20 + 13;
                        eye2Y = segment.y * 20 + 13;
                    }
                    
                    // ç»˜åˆ¶çœ¼ç›
                    ctx.beginPath();
                    ctx.arc(eye1X, eye1Y, 2, 0, Math.PI * 2);
                    ctx.fill();
                    
                    ctx.beginPath();
                    ctx.arc(eye2X, eye2Y, 2, 0, Math.PI * 2);
                    ctx.fill();
                }
            });
            
            // ç»˜åˆ¶é£Ÿç‰©
            ctx.fillStyle = food.type.color;
            drawRoundedRect(food.x * 20, food.y * 20, 18, 18, 5);
            
            // ç»˜åˆ¶é£Ÿç‰©è¡¨æƒ…ç¬¦å·
            ctx.font = '20px Arial';
            ctx.fillText(food.type.emoji, food.x * 20 + 4, food.y * 20 + 16);
            
            // åœ¨é£Ÿç‰©æ—è¾¹æ˜¾ç¤ºåˆ†å€¼
            ctx.font = 'bold 16px Arial';
            ctx.fillStyle = '#333';
            ctx.fillText(food.type.points, food.x * 20 + 5, food.y * 20 - 5);
        }
        
        // ç»˜åˆ¶åœ†è§’çŸ©å½¢
        function drawRoundedRect(x, y, width, height, radius) {
            ctx.beginPath();
            ctx.moveTo(x + radius, y);
            ctx.lineTo(x + width - radius, y);
            ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
            ctx.lineTo(x + width, y + height - radius);
            ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
            ctx.lineTo(x + radius, y + height);
            ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
            ctx.lineTo(x, y + radius);
            ctx.quadraticCurveTo(x, y, x + radius, y);
            ctx.closePath();
            ctx.fill();
        }
        
        // ç»˜åˆ¶ç½‘æ ¼èƒŒæ™¯
        function drawGrid() {
            ctx.strokeStyle = 'rgba(6, 214, 160, 0.1)';
            ctx.lineWidth = 1;
            
            // å‚ç›´çº¿
            for (let x = 0; x <= canvas.width; x += 20) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }
            
            // æ°´å¹³çº¿
            for (let y = 0; y <= canvas.height; y += 20) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }
        }
        
        // æ›´æ–°æ¸¸æˆçŠ¶æ€
        function updateGame() {
            if (gamePaused || !gameRunning) return;
            
            // æ›´æ–°æ–¹å‘
            direction = nextDirection;
            
            // æ ¹æ®æ–¹å‘ç§»åŠ¨è›‡å¤´
            const head = { x: snake[0].x, y: snake[0].y };
            
            switch (direction) {
                case 'up':
                    head.y -= 1;
                    break;
                case 'down':
                    head.y += 1;
                    break;
                case 'left':
                    head.x -= 1;
                    break;
                case 'right':
                    head.x += 1;
                    break;
            }
            
            // æ£€æŸ¥æ˜¯å¦æ’å¢™
            if (
                head.x < 0 || 
                head.x >= canvas.width / 20 || 
                head.y < 0 || 
                head.y >= canvas.height / 20
            ) {
                gameOver();
                return;
            }
            
            // æ£€æŸ¥æ˜¯å¦æ’åˆ°è‡ªå·±
            for (let segment of snake) {
                if (head.x === segment.x && head.y === segment.y) {
                    gameOver();
                    return;
                }
            }
            
            // æ·»åŠ æ–°è›‡å¤´
            snake.unshift(head);
            
            // æ£€æŸ¥æ˜¯å¦åƒåˆ°é£Ÿç‰©
            if (head.x === food.x && head.y === food.y) {
                // å¢åŠ åˆ†æ•°
                score += food.type.points;
                updateScore();
                
                // æ’­æ”¾åƒé£Ÿç‰©çš„å£°éŸ³æ•ˆæœ
                playEatSound(food.type.points);
                
                // ç”Ÿæˆæ–°é£Ÿç‰©
                generateFood();
            } else {
                // å¦‚æœæ²¡æœ‰åƒåˆ°é£Ÿç‰©ï¼Œç§»é™¤è›‡å°¾
                snake.pop();
            }
            
            // ç»˜åˆ¶æ¸¸æˆ
            drawGame();
        }
        
        // æ›´æ–°åˆ†æ•°æ˜¾ç¤º
        function updateScore() {
            scoreElement.textContent = score;
            lengthElement.textContent = snake.length;
            
            // æ›´æ–°æœ€é«˜åˆ†
            if (score > highScore) {
                highScore = score;
                highScoreElement.textContent = highScore;
                // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                localStorage.setItem('snakeHighScore', highScore);
            }
        }
        
        // æ¸¸æˆç»“æŸ
        function gameOver() {
            gameRunning = false;
            clearInterval(gameInterval);
            
            // æ˜¾ç¤ºæœ€ç»ˆåˆ†æ•°
            finalScoreElement.textContent = score;
            
            // æ˜¾ç¤ºæ¸¸æˆç»“æŸç”»é¢
            gameOverScreen.style.display = 'flex';
            
            // æ’­æ”¾æ¸¸æˆç»“æŸå£°éŸ³
            playGameOverSound();
            
            // å¦‚æœæ‰“ç ´è®°å½•ï¼Œæ˜¾ç¤ºç‰¹æ®Šæ¶ˆæ¯
            if (score === highScore && score > 0) {
                const finalScoreText = document.querySelector('.game-over p');
                finalScoreText.innerHTML = `ä½ çš„å¾—åˆ†: <span id="finalScore">${score}</span><br><span style="font-size:1.5rem;color:#ffd166;">æ–°çºªå½•! ğŸ‰</span>`;
            }
        }
        
        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            if (gameRunning) return;
            
            gameRunning = true;
            gamePaused = false;
            
            // éšè—æ¸¸æˆç»“æŸç”»é¢
            gameOverScreen.style.display = 'none';
            
            // å¦‚æœè›‡ä¸ºç©ºï¼Œåˆå§‹åŒ–æ¸¸æˆ
            if (snake.length === 0) {
                initGame();
            }
            
            // å¼€å§‹æ¸¸æˆå¾ªç¯
            clearInterval(gameInterval);
            gameInterval = setInterval(updateGame, gameSpeed);
            
            // æ’­æ”¾å¼€å§‹å£°éŸ³
            playStartSound();
        }
        
        // æš‚åœ/ç»§ç»­æ¸¸æˆ
        function togglePause() {
            if (!gameRunning) return;
            
            gamePaused = !gamePaused;
            document.getElementById('pauseBtn').textContent = gamePaused ? 'ç»§ç»­' : 'æš‚åœ';
            
            if (gamePaused) {
                // ç»˜åˆ¶æš‚åœæ–‡å­—
                ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                ctx.font = 'bold 40px Comic Sans MS';
                ctx.fillStyle = 'white';
                ctx.textAlign = 'center';
                ctx.fillText('æ¸¸æˆæš‚åœ', canvas.width / 2, canvas.height / 2);
                ctx.font = 'bold 20px Comic Sans MS';
                ctx.fillText('ç‚¹å‡»"ç»§ç»­"æŒ‰é’®ç»§ç»­æ¸¸æˆ', canvas.width / 2, canvas.height / 2 + 40);
            }
        }
        
        // é‡æ–°å¼€å§‹æ¸¸æˆ
        function restartGame() {
            clearInterval(gameInterval);
            initGame();
            gameRunning = false;
            gamePaused = false;
            document.getElementById('pauseBtn').textContent = 'æš‚åœ';
            gameOverScreen.style.display = 'none';
        }
        
        // æ”¹å˜æ–¹å‘
        function changeDirection(newDirection) {
            // é˜²æ­¢ç›´æ¥åå‘ç§»åŠ¨ï¼ˆä¾‹å¦‚ä»å³ç›´æ¥åˆ°å·¦ï¼‰
            if (
                (newDirection === 'left' && direction !== 'right') ||
                (newDirection === 'right' && direction !== 'left') ||
                (newDirection === 'up' && direction !== 'down') ||
                (newDirection === 'down' && direction !== 'up')
            ) {
                nextDirection = newDirection;
            }
        }
        
        // è®¾ç½®æ¸¸æˆé€Ÿåº¦
        function setSpeed(speedType) {
            currentSpeed = speedType;
            gameSpeed = SPEEDS[speedType];
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.speed-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // æ ¹æ®é€Ÿåº¦ç±»å‹è®¾ç½®æ­£ç¡®çš„æŒ‰é’®ID
            let buttonId;
            switch(speedType) {
                case 'SLOW':
                    buttonId = 'slowSpeed';
                    break;
                case 'MEDIUM':
                    buttonId = 'mediumSpeed';
                    break;
                case 'FAST':
                    buttonId = 'fastSpeed';
                    break;
                case 'VERY_FAST':
                    buttonId = 'veryFastSpeed';
                    break;
            }
            
            if (buttonId) {
                document.getElementById(buttonId).classList.add('active');
            }
            
            // å¦‚æœæ¸¸æˆæ­£åœ¨è¿›è¡Œä¸­ï¼Œç«‹å³åº”ç”¨æ–°é€Ÿåº¦
            if (gameRunning && !gamePaused) {
                clearInterval(gameInterval);
                gameInterval = setInterval(updateGame, gameSpeed);
            }
        }
        
        // ç®€å•çš„å£°éŸ³æ•ˆæœï¼ˆä½¿ç”¨Web Audio APIï¼‰
        function playEatSound(points) {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                // æ ¹æ®é£Ÿç‰©åˆ†å€¼è°ƒæ•´éŸ³é«˜ï¼ˆåˆ†å€¼è¶Šé«˜éŸ³è°ƒè¶Šé«˜ï¼‰
                const baseFreq = 400;
                const freqIncrement = points / 2; // æ ¹æ®åˆ†å€¼å¢åŠ é¢‘ç‡
                oscillator.frequency.setValueAtTime(baseFreq + freqIncrement, audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(baseFreq + freqIncrement + 300, audioContext.currentTime + 0.1);
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.2);
            } catch (e) {
                // å¦‚æœéŸ³é¢‘APIä¸å¯ç”¨ï¼Œé™é»˜å¤±è´¥
                console.log("éŸ³é¢‘æ’­æ”¾å¤±è´¥ï¼Œä½†æ¸¸æˆç»§ç»­");
            }
        }
        
        function playStartSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5
                oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1); // E5
                oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2); // G5
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.3);
            } catch (e) {
                console.log("éŸ³é¢‘æ’­æ”¾å¤±è´¥ï¼Œä½†æ¸¸æˆç»§ç»­");
            }
        }
        
        function playGameOverSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime); // G5
                oscillator.frequency.exponentialRampToValueAtTime(329.63, audioContext.currentTime + 0.5); // E4
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
            } catch (e) {
                console.log("éŸ³é¢‘æ’­æ”¾å¤±è´¥ï¼Œä½†æ¸¸æˆç»§ç»­");
            }
        }
        
        // äº‹ä»¶ç›‘å¬å™¨
        document.getElementById('startBtn').addEventListener('click', startGame);
        document.getElementById('pauseBtn').addEventListener('click', togglePause);
        document.getElementById('restartBtn').addEventListener('click', restartGame);
        document.getElementById('playAgainBtn').addEventListener('click', startGame);
        
        // é€Ÿåº¦æŒ‰é’®äº‹ä»¶ç›‘å¬ - ä¿®æ­£IDå¼•ç”¨
        document.getElementById('slowSpeed').addEventListener('click', () => setSpeed('SLOW'));
        document.getElementById('mediumSpeed').addEventListener('click', () => setSpeed('MEDIUM'));
        document.getElementById('fastSpeed').addEventListener('click', () => setSpeed('FAST'));
        document.getElementById('veryFastSpeed').addEventListener('click', () => setSpeed('VERY_FAST'));
        
        // é”®ç›˜æ§åˆ¶
        document.addEventListener('keydown', (event) => {
            switch (event.key) {
                case 'ArrowUp':
                    event.preventDefault();
                    changeDirection('up');
                    break;
                case 'ArrowDown':
                    event.preventDefault();
                    changeDirection('down');
                    break;
                case 'ArrowLeft':
                    event.preventDefault();
                    changeDirection('left');
                    break;
                case 'ArrowRight':
                    event.preventDefault();
                    changeDirection('right');
                    break;
                case ' ':
                    event.preventDefault();
                    if (!gameRunning) {
                        startGame();
                    } else {
                        togglePause();
                    }
                    break;
                case 'r':
                case 'R':
                    if (!gameRunning) {
                        restartGame();
                    }
                    break;
            }
        });
        
        // åˆå§‹åŒ–æ¸¸æˆï¼ˆä½†ä¸å¼€å§‹ï¼‰
        initGame();
        
        // æ·»åŠ ä¸€äº›åˆå§‹æç¤º
        ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        ctx.font = 'bold 30px Comic Sans MS';
        ctx.fillStyle = '#ffd166';
        ctx.textAlign = 'center';
        ctx.fillText('ç‚¹å‡»"å¼€å§‹æ¸¸æˆ"æŒ‰é’®å¼€å§‹', canvas.width / 2, canvas.height / 2 - 30);
        ctx.font = 'bold 20px Comic Sans MS';
        ctx.fillStyle = 'white';
        ctx.fillText('ä½¿ç”¨é”®ç›˜æ–¹å‘é”®æ§åˆ¶å°è›‡ç§»åŠ¨', canvas.width / 2, canvas.height / 2 + 20);
        ctx.font = 'bold 18px Comic Sans MS';
        ctx.fillText('çº¢è‰²è‹¹æœæ˜¯æœ€é«˜åˆ†é£Ÿç‰©ï¼ˆ80åˆ†ï¼‰ï¼', canvas.width / 2, canvas.height / 2 + 50);
    </script>
</body>
</html>
